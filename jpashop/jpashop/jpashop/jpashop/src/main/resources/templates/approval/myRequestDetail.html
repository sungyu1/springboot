<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>내 휴가 신청 상세</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/approval-style.css}">
</head>
<body>
    <div class="container mt-4">
        <h2 class="mb-4">내 휴가 신청 상세</h2>
        
        <div th:if="${request != null}">
            <!-- 휴가 신청 정보 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>휴가 신청 정보</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>신청자:</strong> <span th:text="${request.applicant.name}"></span></p>
                            <p><strong>대체근무자:</strong> <span th:text="${request.substitute.name}"></span></p>
                            <p><strong>휴가 종류:</strong> <span th:text="${request.vacationType.displayName}"></span></p>
                            <p><strong>기간:</strong> <span th:text="${#temporals.format(request.startDate, 'yyyy-MM-dd')} + ' ~ ' + ${#temporals.format(request.endDate, 'yyyy-MM-dd')} + ' (' + ${request.totalDays} + '일)'"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>신청일:</strong> <span th:text="${#temporals.format(request.submittedAt, 'yyyy-MM-dd HH:mm')}"></span></p>
                            <p><strong>사유:</strong> <span th:text="${request.reason}"></span></p>
                            <p><strong>상태:</strong> 
                                <span class="status-badge status-pending" th:if="${request.status == 'PENDING'}">대기중</span>
                                <span class="status-badge status-approved" th:if="${request.status == 'APPROVED'}">승인됨</span>
                                <span class="status-badge status-rejected" th:if="${request.status == 'REJECTED'}">반려됨</span>
                                <span class="status-badge status-canceled" th:if="${request.status == 'CANCELED'}">취소됨</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 결재선 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>결재선</h5>
                </div>
                <div class="card-body">
                    <div class="approval-line">
                        <div th:each="step, iterStat : ${request.approvalSteps}" class="approval-step">
                            <div class="step-number" th:text="${step.stepOrder}"></div>
                            <div class="step-info">
                                <div class="approver-name" th:text="${step.approver.name}"></div>
                                <div class="step-status">
                                    <span class="status-badge status-pending" th:if="${step.status == 'PENDING'}">대기중</span>
                                    <span class="status-badge status-approved" th:if="${step.status == 'APPROVED'}">승인</span>
                                    <span class="status-badge status-rejected" th:if="${step.status == 'REJECTED'}">반려</span>
                                </div>
                                <div th:if="${step.comment != null and step.comment != ''}" class="step-comment" th:text="${'사유: ' + step.comment}"></div>
                                <div th:if="${step.approvedAt != null}" class="step-date" th:text="${#temporals.format(step.approvedAt, 'yyyy-MM-dd HH:mm')}"></div>
                            </div>
                            <div th:if="${!iterStat.last}" class="step-arrow">→</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 반려 정보 표시 -->
            <div th:if="${request.status == 'REJECTED'}" class="card mb-4">
                <div class="card-header">
                    <h5>반려 정보</h5>
                </div>
                <div class="card-body">
                    <div th:each="step : ${request.approvalSteps}" th:if="${step.status == 'REJECTED'}" class="rejection-info">
                        <p><strong>반려자:</strong> <span th:text="${step.approver.name}"></span></p>
                        <p><strong>반려일시:</strong> <span th:text="${#temporals.format(step.approvedAt, 'yyyy-MM-dd HH:mm')}"></span></p>
                        <p th:if="${step.comment != null and step.comment != ''}"><strong>반려사유:</strong> <span th:text="${step.comment}"></span></p>
                    </div>
                </div>
            </div>
            
            <!-- 신청자 서명 -->
            <div class="card mb-4" th:if="${request.signatureImage != null and request.signatureImage != ''}">
                <div class="card-header">
                    <h5>신청자 서명</h5>
                </div>
                <div class="card-body">
                    <img th:src="${request.signatureImage}" alt="서명" class="signature-image">
                </div>
            </div>
        </div>
        
        <div class="mt-3">
            <a href="/approval/my-requests" class="btn btn-secondary">내 휴가 신청 목록으로</a>
            <a href="/" class="btn btn-secondary">홈으로</a>
        </div>
    </div>
    
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</body>
</html>
